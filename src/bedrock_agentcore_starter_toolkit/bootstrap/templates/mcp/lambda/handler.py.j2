import json

def lambda_handler(event, context):
    """
    Generic Lambda handler.

    Expected input:
        event: {
            "arguments": {...}  # optional tool arguments
        }
    Context should contain:
        context.client_context.custom["bedrockAgentCoreToolName"]
        â†’ e.g. "LambdaTarget___tool_0"
    """
    try:
        extended_name = context.client_context.custom["bedrockAgentCoreToolName"]
        tool_name = None
        if extended_name and "___" in extended_name:
            tool_name = extended_name.split("___", 1)[1]

        if not tool_name:
            return _response(400, {"error": "Missing tool name"})

        # --- Basic placeholder tools -------------------------------------
        if tool_name in TOOLS:
            result = TOOLS[tool_name](event)
            return _response(200, {"result": result})

        return _response(400, {"error": f"Unknown tool '{tool_name}'"})

    except Exception as e:
        return _response(500, {"system_error": str(e)})


def _response(status_code: int, body: dict):
    """Consistent JSON response wrapper."""
    return {"statusCode": status_code, "body": json.dumps(body)}


# --- Placeholder tool implementations -------------------------------------
def tool_0(event: dict):
    # arg = get_named_parameter(event, "my_param")
    return {"message": "tool_0 executed", "event": event}


def tool_1(event: dict):
    # arg = get_named_parameter(event, "my_param")
    return {"message": "tool_1 executed", "event": event}


def tool_2(event: dict):
    # arg = get_named_parameter(event, "my_param")
    return {"message": "tool_2 executed", "event": event}


TOOLS = {
    "tool_0": tool_0,
    "tool_1": tool_1,
    "tool_2": tool_2,
}

def get_named_parameter(event: dict, name: str):
    """Safely fetch a parameter from the event payload."""
    return event.get(name)