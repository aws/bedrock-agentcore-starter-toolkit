from strands import Agent, tool
from bedrock_agentcore import BedrockAgentCoreApp
from mcp_client.client import get_streamable_http_mcp_client
from model.load import load_model

# Define a simple function tool
@tool
def add_numbers(a: int, b: int) -> int:
    """Return the sum of two numbers"""
    return a+b

# Import AgentCore Gateway as Streamable HTTP MCP Client
mcp_client = get_streamable_http_mcp_client()

# Integrate with Bedrock AgentCore
app = BedrockAgentCoreApp()

@app.entrypoint
def invoke(payload):
    """
    Assume payload input is structured as { "prompt": "<user input>" }
    """
    # Create an Agent with MCP tools
    with mcp_client as client:
        tools = client.list_tools_sync()

        agent = Agent(model=load_model(), tools=tools + [add_numbers])

        # Process the user prompt
        prompt = payload.get("prompt", "What is Agentic AI?")

        # Run the agent
        response = agent(prompt)

        # Return result
        return {
            "response": response
        }

if __name__ == "__main__":
    app.run()
