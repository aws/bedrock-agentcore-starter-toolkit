import os
from autogen_ext.tools.mcp import StreamableHttpMcpToolAdapter, StreamableHttpServerParams

# Define the inbound authentication mechanism for AgentCore Gateway - AWS IAM or JWT
# https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/gateway-inbound-auth.html
def get_bearer_token():
    raise NotImplementedError()

async def get_streamable_http_mcp_client() -> StreamableHttpMcpToolAdapter:
    gateway_url = os.getenv("GATEWAY_URL")
    if not gateway_url:
        raise RuntimeError("Missing required environment variable: GATEWAY_URL")

    server_params = StreamableHttpServerParams(
        url=f"{gateway_url}/mcp",
        headers={
            "Authorization": f"Bearer {get_bearer_token()}"
        }
    )

    return await StreamableHttpMcpToolAdapter.from_server_params(server_params, "AgentCore_Gateway")