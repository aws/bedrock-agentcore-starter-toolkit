from langchain_core.messages import HumanMessage
from langchain.agents import create_agent
from langchain_aws import ChatBedrock
from bedrock_agentcore import BedrockAgentCoreApp
from mcp.client import get_streamable_http_mcp_client

llm = ChatBedrock(model_id="amazon.nova-pro-v1:0")

mcp_client = get_streamable_http_mcp_client()
tools = await mcp_client.get_tools()
graph = create_agent(llm, tools=tools)

app = BedrockAgentCoreApp()

@app.entrypoint
def invoke(payload):
    result = graph.invoke({"messages": [HumanMessage(content=payload["prompt"])]})
    print(result["messages"][-1].content)
    return {
        "result": result["messages"][-1].content
    }

app.run()